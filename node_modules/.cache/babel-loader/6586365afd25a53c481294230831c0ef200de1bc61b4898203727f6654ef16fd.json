{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import Header from\"./components/Header\";import Footer from\"./components/Footer\";import Dashboard from\"./components/Dashboard\";import ApiHandler from\"./components/ApiHandler\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function App(){const[niftyPrice,setNiftyPrice]=useState(null);const[currentTime,setCurrentTime]=useState(new Date());const[apiKey,setApiKey]=useState(localStorage.getItem(\"apiKey\")||\"\");const[authDetails,setAuthDetails]=useState({code:null,client:null});const[loading,setLoading]=useState(true);const navigate=useNavigate();const flattradeAuthUrl=`https://auth.flattrade.in/?app_key=${apiKey}`;const apiEndpoints=[\"https://pi.flattrade.in/api/v1/marketdata/nifty50\"];useEffect(()=>{const timer=setInterval(()=>setCurrentTime(new Date()),1000);return()=>clearInterval(timer);},[]);useEffect(()=>{const queryParams=new URLSearchParams(window.location.search);const code=queryParams.get(\"code\");const client=queryParams.get(\"client\");if(code&&client){setAuthDetails({code,client});localStorage.setItem(\"code\",code);localStorage.setItem(\"client\",client);fetchToken(apiKey,code);}else if(!apiKey){navigate(\"/api-key\");}else{window.location.href=flattradeAuthUrl;}},[apiKey]);const fetchToken=async(key,code)=>{setLoading(true);const crypto=await import(\"crypto-js\");const shaSecret=crypto.SHA256(key+code+\"2025.8199821099b74d748969f3143d73a3b1481bebed356ccf4d\").toString();try{const response=await fetch(\"/.netlify/functions/fetchToken\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({api_key:key,request_code:code,api_secret:shaSecret})});const data=await response.json();if(data!==null&&data!==void 0&&data.token){localStorage.setItem(\"token\",data.token);fetchNiftyPrice();}}catch(error){console.error(\"Token fetch failed:\",error);}finally{setLoading(false);}};const fetchNiftyPrice=async()=>{try{const response=await fetch(apiEndpoints[0]);const data=await response.json();setNiftyPrice((data===null||data===void 0?void 0:data.strikePrice)||\"Unavailable\");}catch(error){console.error(\"Error fetching Nifty 50 price:\",error);}};useEffect(()=>{if(authDetails.code&&authDetails.client){fetchNiftyPrice();const interval=setInterval(fetchNiftyPrice,5000);return()=>clearInterval(interval);}},[authDetails]);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col min-h-screen\",children:[/*#__PURE__*/_jsx(Header,{niftyPrice:niftyPrice}),/*#__PURE__*/_jsx(\"main\",{className:\"flex-grow p-4\",children:loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading authentication and market data...\"}):authDetails.code&&authDetails.client?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Authentication Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Code: \",authDetails.code]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Client: \",authDetails.client]}),/*#__PURE__*/_jsx(ApiHandler,{apiEndpoints:apiEndpoints}),/*#__PURE__*/_jsx(Dashboard,{})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Redirecting to authentication...\"})}),/*#__PURE__*/_jsx(Footer,{currentTime:currentTime.toLocaleString(\"en-IN\",{timeZone:\"Asia/Kolkata\"})})]});}","map":{"version":3,"names":["React","useState","useEffect","Header","Footer","Dashboard","ApiHandler","useNavigate","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","App","niftyPrice","setNiftyPrice","currentTime","setCurrentTime","Date","apiKey","setApiKey","localStorage","getItem","authDetails","setAuthDetails","code","client","loading","setLoading","navigate","flattradeAuthUrl","apiEndpoints","timer","setInterval","clearInterval","queryParams","URLSearchParams","window","location","search","get","setItem","fetchToken","href","key","crypto","shaSecret","SHA256","toString","response","fetch","method","headers","body","JSON","stringify","api_key","request_code","api_secret","data","json","token","fetchNiftyPrice","error","console","strikePrice","interval","className","children","toLocaleString","timeZone"],"sources":["C:/Users/Maheswar/OneDrive/Desktop/hedging/Pro2/flattrade/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport Header from \"./components/Header\";\nimport Footer from \"./components/Footer\";\nimport Dashboard from \"./components/Dashboard\";\nimport ApiHandler from \"./components/ApiHandler\";\nimport { useNavigate } from \"react-router-dom\";\n\nexport default function App() {\n  const [niftyPrice, setNiftyPrice] = useState(null);\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [apiKey, setApiKey] = useState(localStorage.getItem(\"apiKey\") || \"\");\n  const [authDetails, setAuthDetails] = useState({ code: null, client: null });\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n\n  const flattradeAuthUrl = `https://auth.flattrade.in/?app_key=${apiKey}`;\n  const apiEndpoints = [\"https://pi.flattrade.in/api/v1/marketdata/nifty50\"];\n\n  useEffect(() => {\n    const timer = setInterval(() => setCurrentTime(new Date()), 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  useEffect(() => {\n    const queryParams = new URLSearchParams(window.location.search);\n    const code = queryParams.get(\"code\");\n    const client = queryParams.get(\"client\");\n\n    if (code && client) {\n      setAuthDetails({ code, client });\n      localStorage.setItem(\"code\", code);\n      localStorage.setItem(\"client\", client);\n      fetchToken(apiKey, code);\n    } else if (!apiKey) {\n      navigate(\"/api-key\");\n    } else {\n      window.location.href = flattradeAuthUrl;\n    }\n  }, [apiKey]);\n\n  const fetchToken = async (key, code) => {\n    setLoading(true);\n    const crypto = await import(\"crypto-js\");\n    const shaSecret = crypto\n      .SHA256(key + code + \"2025.8199821099b74d748969f3143d73a3b1481bebed356ccf4d\")\n      .toString();\n    try {\n      const response = await fetch(\"/.netlify/functions/fetchToken\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ api_key: key, request_code: code, api_secret: shaSecret }),\n      });\n      const data = await response.json();\n      if (data?.token) {\n        localStorage.setItem(\"token\", data.token);\n        fetchNiftyPrice();\n      }\n    } catch (error) {\n      console.error(\"Token fetch failed:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchNiftyPrice = async () => {\n    try {\n      const response = await fetch(apiEndpoints[0]);\n      const data = await response.json();\n      setNiftyPrice(data?.strikePrice || \"Unavailable\");\n    } catch (error) {\n      console.error(\"Error fetching Nifty 50 price:\", error);\n    }\n  };\n\n  useEffect(() => {\n    if (authDetails.code && authDetails.client) {\n      fetchNiftyPrice();\n      const interval = setInterval(fetchNiftyPrice, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [authDetails]);\n\n  return (\n    <div className=\"flex flex-col min-h-screen\">\n      <Header niftyPrice={niftyPrice} />\n      <main className=\"flex-grow p-4\">\n        {loading ? (\n          <p>Loading authentication and market data...</p>\n        ) : (\n          authDetails.code && authDetails.client ? (\n            <>\n              <h2 className=\"text-xl font-bold mb-4\">Authentication Details</h2>\n              <p>Code: {authDetails.code}</p>\n              <p>Client: {authDetails.client}</p>\n              <ApiHandler apiEndpoints={apiEndpoints} />\n              <Dashboard />\n            </>\n          ) : (\n            <p>Redirecting to authentication...</p>\n          )\n        )}\n      </main>\n      <Footer\n        currentTime={currentTime.toLocaleString(\"en-IN\", {\n          timeZone: \"Asia/Kolkata\",\n        })}\n      />\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}