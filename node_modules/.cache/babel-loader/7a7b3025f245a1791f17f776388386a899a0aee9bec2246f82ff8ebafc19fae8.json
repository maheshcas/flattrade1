{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from\"react\";import{BrowserRouter as Router,Route,Routes,useNavigate}from\"react-router-dom\";import{AppBar,Toolbar,Typography,Box,Container,Paper,Button,TextField,CircularProgress}from\"@mui/material\";import axios from\"axios\";import crypto from\"crypto-js\";import config from\"./config.json\";import ApiHandler from\"./components/ApiHandler\";import Dashboard from\"./components/Dashboard\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const ApiKeyPage=()=>{const[apiKeyInput,setApiKeyInput]=useState(\"\");const navigate=useNavigate();const handleApiKeySubmit=()=>{if(apiKeyInput){localStorage.setItem(\"apiKey\",apiKeyInput);navigate(\"/\");}};return/*#__PURE__*/_jsx(Container,{maxWidth:\"sm\",children:/*#__PURE__*/_jsxs(Paper,{elevation:3,className:\"p-6 mt-16\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Enter API Key\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"API Key\",value:apiKeyInput,onChange:e=>setApiKeyInput(e.target.value),variant:\"outlined\",margin:\"normal\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",fullWidth:true,onClick:handleApiKeySubmit,children:\"Submit\"})]})});};const AuthHandler=_ref=>{let{children}=_ref;const[apiKey,setApiKey]=useState(localStorage.getItem(\"apiKey\")||\"\");const[authDetails,setAuthDetails]=useState({code:null,client:null});const[loading,setLoading]=useState(true);const navigate=useNavigate();const flattradeAuthUrl=`https://auth.flattrade.in/?app_key=${apiKey}`;useEffect(()=>{const queryParams=new URLSearchParams(window.location.search);const code=queryParams.get(\"code\");const client=queryParams.get(\"client\");if(code&&client){setAuthDetails({code,client});localStorage.setItem(\"code\",code);localStorage.setItem(\"client\",client);fetchToken(apiKey,code);}else if(!apiKey){navigate(\"/api-key\");}else{window.location.href=flattradeAuthUrl;}},[apiKey]);const fetchToken=async(key,code)=>{setLoading(true);const shaSecret=crypto.SHA256(key+code+config.api_secret).toString();try{var _response$data;const response=await axios.post(\"/api/fetchToken\",{api_key:key,request_code:code,api_secret:shaSecret});if((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.token){localStorage.setItem(\"token\",response.data.token);}}catch(error){console.error(\"Token fetch failed:\",error);}finally{setLoading(false);}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{authDetails,loading},children:children});};const AuthenticatedPage=()=>{const{authDetails,loading}=useContext(AuthContext);return/*#__PURE__*/_jsx(Container,{children:loading?/*#__PURE__*/_jsx(CircularProgress,{}):/*#__PURE__*/_jsxs(Box,{className:\"mt-8\",children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Code: \",authDetails.code]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Client: \",authDetails.client]}),/*#__PURE__*/_jsx(ApiHandler,{}),/*#__PURE__*/_jsx(Dashboard,{})]})});};export default function App(){return/*#__PURE__*/_jsxs(Router,{children:[/*#__PURE__*/_jsx(AppBar,{position:\"static\",children:/*#__PURE__*/_jsx(Toolbar,{children:/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Flattrade Option Trading App\"})})}),/*#__PURE__*/_jsx(AuthHandler,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/api-key\",element:/*#__PURE__*/_jsx(ApiKeyPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(AuthenticatedPage,{})})]})})]});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","BrowserRouter","Router","Route","Routes","useNavigate","AppBar","Toolbar","Typography","Box","Container","Paper","Button","TextField","CircularProgress","axios","crypto","config","ApiHandler","Dashboard","jsx","_jsx","jsxs","_jsxs","AuthContext","ApiKeyPage","apiKeyInput","setApiKeyInput","navigate","handleApiKeySubmit","localStorage","setItem","maxWidth","children","elevation","className","variant","gutterBottom","fullWidth","label","value","onChange","e","target","margin","onClick","AuthHandler","_ref","apiKey","setApiKey","getItem","authDetails","setAuthDetails","code","client","loading","setLoading","flattradeAuthUrl","queryParams","URLSearchParams","window","location","search","get","fetchToken","href","key","shaSecret","SHA256","api_secret","toString","_response$data","response","post","api_key","request_code","data","token","error","console","Provider","AuthenticatedPage","App","position","path","element"],"sources":["C:/Users/Maheswar/OneDrive/Desktop/hedging/Pro2/flattrade/src/App.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Route,\n  Routes,\n  useNavigate,\n} from \"react-router-dom\";\nimport {\n  AppBar,\n  Toolbar,\n  Typography,\n  Box,\n  Container,\n  Paper,\n  Button,\n  TextField,\n  CircularProgress,\n} from \"@mui/material\";\nimport axios from \"axios\";\nimport crypto from \"crypto-js\";\nimport config from \"./config.json\";\nimport ApiHandler from \"./components/ApiHandler\";\nimport Dashboard from \"./components/Dashboard\";\n\nconst AuthContext = createContext();\n\nconst ApiKeyPage = () => {\n  const [apiKeyInput, setApiKeyInput] = useState(\"\");\n  const navigate = useNavigate();\n\n  const handleApiKeySubmit = () => {\n    if (apiKeyInput) {\n      localStorage.setItem(\"apiKey\", apiKeyInput);\n      navigate(\"/\");\n    }\n  };\n\n  return (\n    <Container maxWidth=\"sm\">\n      <Paper elevation={3} className=\"p-6 mt-16\">\n        <Typography variant=\"h5\" gutterBottom>\n          Enter API Key\n        </Typography>\n        <TextField\n          fullWidth\n          label=\"API Key\"\n          value={apiKeyInput}\n          onChange={(e) => setApiKeyInput(e.target.value)}\n          variant=\"outlined\"\n          margin=\"normal\"\n        />\n        <Button variant=\"contained\" fullWidth onClick={handleApiKeySubmit}>\n          Submit\n        </Button>\n      </Paper>\n    </Container>\n  );\n};\n\nconst AuthHandler = ({ children }) => {\n  const [apiKey, setApiKey] = useState(localStorage.getItem(\"apiKey\") || \"\");\n  const [authDetails, setAuthDetails] = useState({ code: null, client: null });\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n\n  const flattradeAuthUrl = `https://auth.flattrade.in/?app_key=${apiKey}`;\n\n  useEffect(() => {\n    const queryParams = new URLSearchParams(window.location.search);\n    const code = queryParams.get(\"code\");\n    const client = queryParams.get(\"client\");\n\n    if (code && client) {\n      setAuthDetails({ code, client });\n      localStorage.setItem(\"code\", code);\n      localStorage.setItem(\"client\", client);\n      fetchToken(apiKey, code);\n    } else if (!apiKey) {\n      navigate(\"/api-key\");\n    } else {\n      window.location.href = flattradeAuthUrl;\n    }\n  }, [apiKey]);\n\n  const fetchToken = async (key, code) => {\n    setLoading(true);\n    const shaSecret = crypto\n      .SHA256(key + code + config.api_secret)\n      .toString();\n    try {\n      const response = await axios.post(\"/api/fetchToken\", {\n        api_key: key,\n        request_code: code,\n        api_secret: shaSecret,\n      });\n      if (response.data?.token) {\n        localStorage.setItem(\"token\", response.data.token);\n      }\n    } catch (error) {\n      console.error(\"Token fetch failed:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ authDetails, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nconst AuthenticatedPage = () => {\n  const { authDetails, loading } = useContext(AuthContext);\n\n  return (\n    <Container>\n      {loading ? (\n        <CircularProgress />\n      ) : (\n        <Box className=\"mt-8\">\n          <Typography variant=\"h6\">Code: {authDetails.code}</Typography>\n          <Typography variant=\"h6\">Client: {authDetails.client}</Typography>\n          <ApiHandler />\n          <Dashboard />\n        </Box>\n      )}\n    </Container>\n  );\n};\n\nexport default function App() {\n  return (\n    <Router>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <Typography variant=\"h6\">Flattrade Option Trading App</Typography>\n        </Toolbar>\n      </AppBar>\n      <AuthHandler>\n        <Routes>\n          <Route path=\"/api-key\" element={<ApiKeyPage />} />\n          <Route path=\"/\" element={<AuthenticatedPage />} />\n        </Routes>\n      </AuthHandler>\n    </Router>\n  );\n}\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC7E,OACEC,aAAa,GAAI,CAAAC,MAAM,CACvBC,KAAK,CACLC,MAAM,CACNC,WAAW,KACN,kBAAkB,CACzB,OACEC,MAAM,CACNC,OAAO,CACPC,UAAU,CACVC,GAAG,CACHC,SAAS,CACTC,KAAK,CACLC,MAAM,CACNC,SAAS,CACTC,gBAAgB,KACX,eAAe,CACtB,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,MAAM,KAAM,WAAW,CAC9B,MAAO,CAAAC,MAAM,KAAM,eAAe,CAClC,MAAO,CAAAC,UAAU,KAAM,yBAAyB,CAChD,MAAO,CAAAC,SAAS,KAAM,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE/C,KAAM,CAAAC,WAAW,cAAG3B,aAAa,CAAC,CAAC,CAEnC,KAAM,CAAA4B,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAG5B,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAAA6B,QAAQ,CAAGvB,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAwB,kBAAkB,CAAGA,CAAA,GAAM,CAC/B,GAAIH,WAAW,CAAE,CACfI,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAEL,WAAW,CAAC,CAC3CE,QAAQ,CAAC,GAAG,CAAC,CACf,CACF,CAAC,CAED,mBACEP,IAAA,CAACX,SAAS,EAACsB,QAAQ,CAAC,IAAI,CAAAC,QAAA,cACtBV,KAAA,CAACZ,KAAK,EAACuB,SAAS,CAAE,CAAE,CAACC,SAAS,CAAC,WAAW,CAAAF,QAAA,eACxCZ,IAAA,CAACb,UAAU,EAAC4B,OAAO,CAAC,IAAI,CAACC,YAAY,MAAAJ,QAAA,CAAC,eAEtC,CAAY,CAAC,cACbZ,IAAA,CAACR,SAAS,EACRyB,SAAS,MACTC,KAAK,CAAC,SAAS,CACfC,KAAK,CAAEd,WAAY,CACnBe,QAAQ,CAAGC,CAAC,EAAKf,cAAc,CAACe,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAChDJ,OAAO,CAAC,UAAU,CAClBQ,MAAM,CAAC,QAAQ,CAChB,CAAC,cACFvB,IAAA,CAACT,MAAM,EAACwB,OAAO,CAAC,WAAW,CAACE,SAAS,MAACO,OAAO,CAAEhB,kBAAmB,CAAAI,QAAA,CAAC,QAEnE,CAAQ,CAAC,EACJ,CAAC,CACC,CAAC,CAEhB,CAAC,CAED,KAAM,CAAAa,WAAW,CAAGC,IAAA,EAAkB,IAAjB,CAAEd,QAAS,CAAC,CAAAc,IAAA,CAC/B,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGlD,QAAQ,CAAC+B,YAAY,CAACoB,OAAO,CAAC,QAAQ,CAAC,EAAI,EAAE,CAAC,CAC1E,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAGrD,QAAQ,CAAC,CAAEsD,IAAI,CAAE,IAAI,CAAEC,MAAM,CAAE,IAAK,CAAC,CAAC,CAC5E,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGzD,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAA6B,QAAQ,CAAGvB,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAoD,gBAAgB,CAAG,sCAAsCT,MAAM,EAAE,CAEvEhD,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0D,WAAW,CAAG,GAAI,CAAAC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAC/D,KAAM,CAAAT,IAAI,CAAGK,WAAW,CAACK,GAAG,CAAC,MAAM,CAAC,CACpC,KAAM,CAAAT,MAAM,CAAGI,WAAW,CAACK,GAAG,CAAC,QAAQ,CAAC,CAExC,GAAIV,IAAI,EAAIC,MAAM,CAAE,CAClBF,cAAc,CAAC,CAAEC,IAAI,CAAEC,MAAO,CAAC,CAAC,CAChCxB,YAAY,CAACC,OAAO,CAAC,MAAM,CAAEsB,IAAI,CAAC,CAClCvB,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAEuB,MAAM,CAAC,CACtCU,UAAU,CAAChB,MAAM,CAAEK,IAAI,CAAC,CAC1B,CAAC,IAAM,IAAI,CAACL,MAAM,CAAE,CAClBpB,QAAQ,CAAC,UAAU,CAAC,CACtB,CAAC,IAAM,CACLgC,MAAM,CAACC,QAAQ,CAACI,IAAI,CAAGR,gBAAgB,CACzC,CACF,CAAC,CAAE,CAACT,MAAM,CAAC,CAAC,CAEZ,KAAM,CAAAgB,UAAU,CAAG,KAAAA,CAAOE,GAAG,CAAEb,IAAI,GAAK,CACtCG,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAW,SAAS,CAAGnD,MAAM,CACrBoD,MAAM,CAACF,GAAG,CAAGb,IAAI,CAAGpC,MAAM,CAACoD,UAAU,CAAC,CACtCC,QAAQ,CAAC,CAAC,CACb,GAAI,KAAAC,cAAA,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAzD,KAAK,CAAC0D,IAAI,CAAC,iBAAiB,CAAE,CACnDC,OAAO,CAAER,GAAG,CACZS,YAAY,CAAEtB,IAAI,CAClBgB,UAAU,CAAEF,SACd,CAAC,CAAC,CACF,IAAAI,cAAA,CAAIC,QAAQ,CAACI,IAAI,UAAAL,cAAA,WAAbA,cAAA,CAAeM,KAAK,CAAE,CACxB/C,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEyC,QAAQ,CAACI,IAAI,CAACC,KAAK,CAAC,CACpD,CACF,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAEA,KAAK,CAAC,CAC7C,CAAC,OAAS,CACRtB,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,mBACEnC,IAAA,CAACG,WAAW,CAACwD,QAAQ,EAACxC,KAAK,CAAE,CAAEW,WAAW,CAAEI,OAAQ,CAAE,CAAAtB,QAAA,CACnDA,QAAQ,CACW,CAAC,CAE3B,CAAC,CAED,KAAM,CAAAgD,iBAAiB,CAAGA,CAAA,GAAM,CAC9B,KAAM,CAAE9B,WAAW,CAAEI,OAAQ,CAAC,CAAGzD,UAAU,CAAC0B,WAAW,CAAC,CAExD,mBACEH,IAAA,CAACX,SAAS,EAAAuB,QAAA,CACPsB,OAAO,cACNlC,IAAA,CAACP,gBAAgB,GAAE,CAAC,cAEpBS,KAAA,CAACd,GAAG,EAAC0B,SAAS,CAAC,MAAM,CAAAF,QAAA,eACnBV,KAAA,CAACf,UAAU,EAAC4B,OAAO,CAAC,IAAI,CAAAH,QAAA,EAAC,QAAM,CAACkB,WAAW,CAACE,IAAI,EAAa,CAAC,cAC9D9B,KAAA,CAACf,UAAU,EAAC4B,OAAO,CAAC,IAAI,CAAAH,QAAA,EAAC,UAAQ,CAACkB,WAAW,CAACG,MAAM,EAAa,CAAC,cAClEjC,IAAA,CAACH,UAAU,GAAE,CAAC,cACdG,IAAA,CAACF,SAAS,GAAE,CAAC,EACV,CACN,CACQ,CAAC,CAEhB,CAAC,CAED,cAAe,SAAS,CAAA+D,GAAGA,CAAA,CAAG,CAC5B,mBACE3D,KAAA,CAACrB,MAAM,EAAA+B,QAAA,eACLZ,IAAA,CAACf,MAAM,EAAC6E,QAAQ,CAAC,QAAQ,CAAAlD,QAAA,cACvBZ,IAAA,CAACd,OAAO,EAAA0B,QAAA,cACNZ,IAAA,CAACb,UAAU,EAAC4B,OAAO,CAAC,IAAI,CAAAH,QAAA,CAAC,8BAA4B,CAAY,CAAC,CAC3D,CAAC,CACJ,CAAC,cACTZ,IAAA,CAACyB,WAAW,EAAAb,QAAA,cACVV,KAAA,CAACnB,MAAM,EAAA6B,QAAA,eACLZ,IAAA,CAAClB,KAAK,EAACiF,IAAI,CAAC,UAAU,CAACC,OAAO,cAAEhE,IAAA,CAACI,UAAU,GAAE,CAAE,CAAE,CAAC,cAClDJ,IAAA,CAAClB,KAAK,EAACiF,IAAI,CAAC,GAAG,CAACC,OAAO,cAAEhE,IAAA,CAAC4D,iBAAiB,GAAE,CAAE,CAAE,CAAC,EAC5C,CAAC,CACE,CAAC,EACR,CAAC,CAEb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}